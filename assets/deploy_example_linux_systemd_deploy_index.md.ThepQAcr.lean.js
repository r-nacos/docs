import{_ as r,B as t,o as c,c as h,j as n,a,G as p,w as l,a3 as e}from"./chunks/framework.C4orK2dt.js";const y=JSON.parse('{"title":"使用systemd部署r-nacos","description":"","frontmatter":{},"headers":[],"relativePath":"deploy_example/linux_systemd_deploy/index.md","filePath":"zh/deploy_example/linux_systemd_deploy/index.md","lastUpdated":1733968575000}'),o={name:"deploy_example/linux_systemd_deploy/index.md"};function d(k,s,b,u,m,F){const i=t("VPNolebaseInlineLinkPreview");return c(),h("div",{"data-pagefind-body":!0},[s[6]||(s[6]=n("h1",{id:"使用systemd部署r-nacos",tabindex:"-1"},[a("使用systemd部署r-nacos "),n("a",{class:"header-anchor",href:"#使用systemd部署r-nacos","aria-label":'Permalink to "使用systemd部署r-nacos"'},"​")],-1)),s[7]||(s[7]=n("h2",{id:"_1、-前言",tabindex:"-1"},[a("1、 前言 "),n("a",{class:"header-anchor",href:"#_1、-前言","aria-label":'Permalink to "1、 前言"'},"​")],-1)),n("p",null,[p(i,{href:"https://github.com/r-nacos/r-nacos",target:"_blank",rel:"noreferrer"},{default:l(()=>s[0]||(s[0]=[a("r-nacos")])),_:1}),s[1]||(s[1]=a("是一个用rust实现的nacos服务。相较于java nacos来说，是一个提供相同功能，启动更快、占用系统资源更小（初始内存小于10M）、性能更高、运行更稳定的服务。"))]),s[8]||(s[8]=e(`<p>r-nacos设计上完全兼容最新版本nacos面向client sdk 的协议（包含1.x的http OpenApi，和2.x的grpc协议）, 支持使用nacos服务的应用平迁到 r-nacos。</p><p>r-nacos在本地测试使用很简单,通过<code>./rnacos</code>直接启动应用即可。 但是生产环境中还是需要更规范的方式部署运行。</p><p>目前的linux服务基本默认支持systemd统一管理服务。 本文主要记录使用systemd部分r-nacos的过程说明。</p><h2 id="_2、规划r-nacos运行位置" tabindex="-1">2、规划r-nacos运行位置 <a class="header-anchor" href="#_2、规划r-nacos运行位置" aria-label="Permalink to &quot;2、规划r-nacos运行位置&quot;">​</a></h2><ol><li>服务应用放到 <code>/opt/rnacos/</code> 中</li><li>r-nacos配置使用 <code>/etc/rnacos/env.conf</code></li><li>数据放到 <code>/var/rnacos/io/</code> 中</li><li>systemd 服务配置放到 <code>/lib/systemd/system/rnacos.service</code></li></ol><h2 id="_3、部署" tabindex="-1">3、部署 <a class="header-anchor" href="#_3、部署" aria-label="Permalink to &quot;3、部署&quot;">​</a></h2><ol><li>下载服务应用</li></ol><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/rnacos/</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/rnacos/</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#download from github</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -LO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/r-nacos/r-nacos/releases/download/v0.5.0/rnacos-x86_64-unknown-linux-musl.tar.gz</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#download from gitee</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#curl -LO https://gitee.com/hqp/rnacos/releases/download/v0.5.0/rnacos-x86_64-unknown-linux-musl.tar.gz</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tar</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -xvf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rnacos-x86_64-unknown-linux-musl.tar.gz</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ol start="2"><li>增加r-nacos服务配置</li></ol><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/rnacos/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/etc/rnacos/env.conf</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"># rnacos 指定配置文件有两种方式：</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"># 1. 默认文件（放置于运行目录下，文件名为“.env”，自动读取）</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"># 2. 指定文件（放置于任意目录下， 通过 命令行参数“-e 文件路径”形式指定， 如“./rnacos -e /etc/rnacos/conf/default.cnf”）</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"># 更多说明请参照  https://r-nacos.github.io/r-nacos/deplay_env.html</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"># r-nacos监听http端口，默认值：8848</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">RNACOS_HTTP_PORT=8848</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">#r-nacos监听grpc端口，默认值：HTTP端口+1000(即9848） </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">#RNACOS_GRPC_PORT=9848</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">#r-nacos独立控制台端口，默认值：HTTP端口+2000(即10848）;设置为0可不开启独立控制台</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">#RNACOS_HTTP_CONSOLE_PORT=10848</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">#r-nacos控制台登录1小时失败次数限制默认是5,一个用户连续登陆失败5次，会被锁定1个小时 ，默认值：1</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">RNACOS_CONSOLE_LOGIN_ONE_HOUR_LIMIT=5</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">#http工作线程数，默认值：cpu核数 </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">#RNACOS_HTTP_WORKERS=8</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">#配置中心的本地数据库sled文件夹, 会在系统运行时自动创建 ，默认值：nacos_db</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">RNACOS_CONFIG_DB_DIR=nacos_db</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">#节点id，默认值：1</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">RNACOS_RAFT_NODE_ID=1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">#节点地址Ip:GrpcPort,单节点运行时每次启动都会生效；多节点集群部署时，只取加入集群时配置的值，默认值：127.0.0.1:GrpcPort </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">RNACOS_RAFT_NODE_ADDR=127.0.0.1:9848</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">#是否当做主节点初始化,(只在每一次启动时生效)节点1时默认为true,节点非1时为false </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">#RNACOS_RAFT_AUTO_INIT=true</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">#是否当做节点加入对应的主节点,LeaderIp:GrpcPort；只在第一次启动时生效；默认值：空 </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">#RNACOS_RAFT_JOIN_ADDR=127.0.0.1:9848</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">#日志等级:debug,info,warn,error;所有http,grpc请求都会打info日志,如果不关注，可以设置为error 减少日志量，默认值：info</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">RUST_LOG=info</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><ol start="3"><li>初始化r-nacos数据目录</li></ol><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/rnacos/io/</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 如果使用rnacos用户运行，则要开放目录写权限给用户</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># adduser rnacos</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># chown -R rnacos:rnacos /var/rnacos</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="4"><li>初始化r-nacos 服务配置</li></ol><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/lib/systemd/system/rnacos.service</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">[Unit]</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Description=r-nacos server</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">After=network.target</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">[Service]</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">#使用指定用户运行</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">#User=rnacos</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">#Group=rnacos</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ExecStart=/opt/rnacos/rnacos -e /etc/rnacos/env.conf</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"># 进程异常关闭时会自动重启</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Restart=always</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">WorkingDirectory=/var/rnacos/io</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">[Install]</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">WantedBy=multi-user.target</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><ol start="5"><li>重新加载并启动服务</li></ol><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 重新加载配置</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> daemon-reload</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启用服务并马上启动</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --now</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rnacos</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看服务状态</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rnacos</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>把上以的脚本连起来执行，r-nacos服务即可部署完成。</p>`,17)),n("p",null,[s[3]||(s[3]=a("整合起来的脚本可以参考： ")),p(i,{href:"https://github.com/nacos-group/r-nacos/blob/v0.5.17/tools/linux-systemd-deploy.sh",target:"_blank",rel:"noreferrer"},{default:l(()=>s[2]||(s[2]=[a("linux-systemd-deploy.sh")])),_:1})]),s[9]||(s[9]=e(`<h2 id="_4、管理服务" tabindex="-1">4、管理服务 <a class="header-anchor" href="#_4、管理服务" aria-label="Permalink to &quot;4、管理服务&quot;">​</a></h2><ol><li>使用<code>systemctl</code>管理服务</li></ol><p>常用的命令</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 查看服务状态</span></span>
<span class="line"><span>systemctl status rnacos</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 启动服务</span></span>
<span class="line"><span>systemctl start rnacos</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 关闭服务</span></span>
<span class="line"><span>systemctl stop rnacos</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 启动服务，开机自动启动</span></span>
<span class="line"><span>systemctl enable rnacos</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 禁用服务，开机不启动</span></span>
<span class="line"><span>systemctl disable rnacos</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ol start="2"><li>同时可以结合使用<code>journalctl</code> 管理查看服务日志</li></ol><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看日志</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">journalctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rnacos</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看最新日志</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">journalctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rnacos</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -f</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>其它journalctl日志管理方式，可以单独支了解，这里不展开。</p><h2 id="_5、验证服务" tabindex="-1">5、验证服务 <a class="header-anchor" href="#_5、验证服务" aria-label="Permalink to &quot;5、验证服务&quot;">​</a></h2><h3 id="_5-1-shell-本地-http验证" tabindex="-1">5.1 shell 本地 http验证 <a class="header-anchor" href="#_5-1-shell-本地-http验证" aria-label="Permalink to &quot;5.1 shell 本地 http验证&quot;">​</a></h3><ol><li>配置中心http api例子</li></ol><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 设置配置</span></span>
<span class="line"><span>curl -X POST &#39;http://127.0.0.1:8848/nacos/v1/cs/configs&#39; -d &#39;dataId=t001&amp;group=foo&amp;content=contentTest&#39;</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 查询</span></span>
<span class="line"><span>curl &#39;http://127.0.0.1:8848/nacos/v1/cs/configs?dataId=t001&amp;group=foo&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="2"><li>注册中心http api例子</li></ol><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 注册服务实例</span></span>
<span class="line"><span>curl -X POST &#39;http://127.0.0.1:8848/nacos/v1/ns/instance&#39; -d &#39;port=8000&amp;healthy=true&amp;ip=192.168.1.11&amp;weight=1.0&amp;serviceName=nacos.test.001&amp;groupName=foo&amp;metadata={&quot;app&quot;:&quot;foo&quot;,&quot;id&quot;:&quot;001&quot;}&#39;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>curl -X POST &#39;http://127.0.0.1:8848/nacos/v1/ns/instance&#39; -d &#39;port=8000&amp;healthy=true&amp;ip=192.168.1.12&amp;weight=1.0&amp;serviceName=nacos.test.001&amp;groupName=foo&amp;metadata={&quot;app&quot;:&quot;foo&quot;,&quot;id&quot;:&quot;002&quot;}&#39;</span></span>
<span class="line"><span></span></span>
<span class="line"><span> curl -X POST &#39;http://127.0.0.1:8848/nacos/v1/ns/instance&#39; -d &#39;port=8000&amp;healthy=true&amp;ip=192.168.1.13&amp;weight=1.0&amp;serviceName=nacos.test.001&amp;groupName=foo&amp;metadata={&quot;app&quot;:&quot;foo&quot;,&quot;id&quot;:&quot;003&quot;}&#39;</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 查询服务实例</span></span>
<span class="line"><span></span></span>
<span class="line"><span>curl &quot;http://127.0.0.1:8848/nacos/v1/ns/instance/list?&amp;namespaceId=public&amp;serviceName=foo%40%40nacos.test.001&amp;groupName=foo&amp;clusters=&amp;healthyOnly=true&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_5-2-nacos客户端应用验证" tabindex="-1">5.2 nacos客户端应用验证 <a class="header-anchor" href="#_5-2-nacos客户端应用验证" aria-label="Permalink to &quot;5.2 nacos客户端应用验证&quot;">​</a></h3><p>如果客户端应用与nacos服务不在同一台机器，需要开放<code>8848</code>,<code>9848</code>端口给内网应用使用。（注意<code>8848</code>,<code>9848</code>端口不能暴露到外网上）</p><p>在客户端应用中配置好nacos服务后，即可运行验证。</p><h3 id="_5-3-使用r-nacos控制台" tabindex="-1">5.3 使用r-nacos控制台 <a class="header-anchor" href="#_5-3-使用r-nacos控制台" aria-label="Permalink to &quot;5.3 使用r-nacos控制台&quot;">​</a></h3><p>开放<code>10848</code> 端口后，可以通过对应ip+端口在浏览器访问控制台。</p><p>新控制台有完备的用户管理、登陆校验、权限控制，支持对外网暴露。</p><p>系统会默认创建一个名为admin的用户，密码为admin。</p><h2 id="_6、总结" tabindex="-1">6、总结 <a class="header-anchor" href="#_6、总结" aria-label="Permalink to &quot;6、总结&quot;">​</a></h2><p>r-nacos是一个用rust实现的nacos服务，我们用它平替java nacos以降低服务占用内存，提升服务的稳定性。</p><p>systemd提供便捷的服务托管功能，可以方便的将一个命令运行的应用，转化成一个可方便控制的后台服务。</p><p>使用systemd部署r-nacos，是一个比较和合适的、可用于生产环境的部署方案。</p><hr><p>时间: 2024-03-26</p>`,26)),n("p",null,[s[5]||(s[5]=a("作者: ")),p(i,{href:"https://github.com/heqingpan",target:"_blank",rel:"noreferrer"},{default:l(()=>s[4]||(s[4]=[a("heqingpan")])),_:1})])])}const C=r(o,[["render",d]]);export{y as __pageData,C as default};
